<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro de Empresa - Dados da Empresa</title>
    <link rel="stylesheet" href="/css/cadastro-comum.css" />
    <link rel="stylesheet" href="/css/validation.css" />
    <style>
      /* Estilos específicos para o step progress */
      .step-progress {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 30px;
        gap: 20px;
      }
      
      .step {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background: #e6e6f0;
        color: #9b9bb3;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 14px;
      }
      
      .step.active {
        background: var(--primary);
        color: white;
      }
      
      .step.completed {
        background: var(--secundary);
        color: var(--primary);
      }
      
      .step-line {
        width: 40px;
        height: 2px;
        background: #e6e6f0;
      }
      
      .step-line.completed {
        background: var(--secundary);
      }
      
      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }
      
      .col {
        display: flex;
        flex-direction: column;
      }
    </style>
  </head>

  <body>
    <%- include('../partials/menu') %>
    
    <header>
      <h1 class="cadastro">Dados da Empresa</h1>
    </header>

    <main class="cad-container">
      <!-- Indicador de Progresso -->
      <nav class="step-progress">
        <article class="step active">1</article>
        <span class="step-line"></span>
        <article class="step">2</article>
        <span class="step-line"></span>
        <article class="step">3</article>
      </nav>

      <section class="form-section">
        <p>Informe os dados básicos da sua empresa</p>
        
        <!-- Mostrar erros gerais se existirem -->
        <% if (typeof errors !== 'undefined' && errors && errors.length > 0) { %>
          <article class="general-error">
            <% errors.forEach(function(error) { %>
              <%= error.msg %><br>
            <% }) %>
          </article>
        <% } %>
        
        <form id="empresaForm1" class="cad-form" method="POST" action="/cadastro-empresa">

          <%
            function getFieldError(fieldName) {
              return (errors && errors.length) ? errors.find(function (it) { return it.param === fieldName; }) : null;
            }
            function getFieldValue(fieldName) {
              return (form && form[fieldName]) ? form[fieldName] : '';
            }
          %>

          <% var e = getFieldError('razao_social'); %>
          <input type="text" id="razao_social" name="razao_social" placeholder="Razão social (nome jurídico)" 
                 value="<%= getFieldValue('razao_social') %>" required />
          <span class="field-error"><%= e ? e.msg : '' %></span>

          <% var e = getFieldError('nome_fantasia'); %>
          <input type="text" id="nome_fantasia" name="nome_fantasia" placeholder="Nome Fantasia" 
                 value="<%= getFieldValue('nome_fantasia') %>" required />
          <span class="field-error"><%= e ? e.msg : '' %></span>

          <% var e = getFieldError('cnpj'); %>
          <input type="text" id="cnpj" name="cnpj" placeholder="CNPJ" inputmode="numeric" maxlength="18" 
                 value="<%= getFieldValue('cnpj') %>" required />
          <span class="field-error"><%= e ? e.msg : '' %></span>

          <% var e = getFieldError('telefone'); %>
          <input type="tel" id="telefone" name="telefone" placeholder="(00) 00000-0000" inputmode="tel" maxlength="15" 
                 value="<%= getFieldValue('telefone') %>" required />
          <span class="field-error"><%= e ? e.msg : '' %></span>

          <label style="margin-top:10px; font-size:0.85rem; color:#666">Logradouro da sede</label>

          <% var e = getFieldError('logradouro'); %>
          <input type="text" id="logradouro" name="logradouro" placeholder="Rua" 
                 value="<%= getFieldValue('logradouro') %>" required />
          <span class="field-error"><%= e ? e.msg : '' %></span>

          <% var e = getFieldError('cidade'); %>
          <input type="text" id="cidade" name="cidade" placeholder="Cidade" 
                 value="<%= getFieldValue('cidade') %>" required />
          <span class="field-error"><%= e ? e.msg : '' %></span>

          <% var e = getFieldError('estado'); %>
          <select id="estado" name="estado" required>
            <option value="">Selecione o estado</option>
            <%
              const estados = [
                {value: 'AC', text: 'Acre (AC)'}, {value: 'AL', text: 'Alagoas (AL)'}, 
                {value: 'AP', text: 'Amapá (AP)'}, {value: 'AM', text: 'Amazonas (AM)'}, 
                {value: 'BA', text: 'Bahia (BA)'}, {value: 'CE', text: 'Ceará (CE)'}, 
                {value: 'ES', text: 'Espírito Santo (ES)'}, {value: 'GO', text: 'Goiás (GO)'}, 
                {value: 'MA', text: 'Maranhão (MA)'}, {value: 'MT', text: 'Mato Grosso (MT)'}, 
                {value: 'MS', text: 'Mato Grosso do Sul (MS)'}, {value: 'MG', text: 'Minas Gerais (MG)'}, 
                {value: 'PA', text: 'Pará (PA)'}, {value: 'PB', text: 'Paraíba (PB)'}, 
                {value: 'PR', text: 'Paraná (PR)'}, {value: 'PE', text: 'Pernambuco (PE)'}, 
                {value: 'PI', text: 'Piauí (PI)'}, {value: 'RJ', text: 'Rio de Janeiro (RJ)'}, 
                {value: 'RN', text: 'Rio Grande do Norte (RN)'}, {value: 'RS', text: 'Rio Grande do Sul (RS)'}, 
                {value: 'RO', text: 'Rondônia (RO)'}, {value: 'RR', text: 'Roraima (RR)'}, 
                {value: 'SC', text: 'Santa Catarina (SC)'}, {value: 'SP', text: 'São Paulo (SP)'}, 
                {value: 'SE', text: 'Sergipe (SE)'}, {value: 'TO', text: 'Tocantins (TO)'}
              ];
            %>
            <% estados.forEach(function(estado) { %>
              <option value="<%= estado.value %>" <%= (form && form.estado === estado.value) ? 'selected' : '' %>><%= estado.text %></option>
            <% }); %>
          </select>
          <span class="field-error"><%= e ? e.msg : '' %></span>

          <section class="row">
            <fieldset class="col">
              <% var e = getFieldError('cep'); %>
              <input type="text" id="cep" name="cep" placeholder="CEP (00000-000)" inputmode="numeric" maxlength="9" 
                     value="<%= getFieldValue('cep') %>" required />
              <span class="field-error"><%= e ? e.msg : '' %></span>
            </fieldset>

            <fieldset class="col">
              <% var e = getFieldError('complemento'); %>
              <input type="text" id="complemento" name="complemento" placeholder="Complemento (opcional)" 
                     value="<%= getFieldValue('complemento') %>" />
              <span class="field-error"><%= e ? e.msg : '' %></span>
            </fieldset>
          </section>
        </form>
      </section>

      <nav class="actions-section">
        <button id="btnProximo" class="btn-primary">Próximo</button>
      </nav>
      
      <div class="form-footer">
        <p>Já tem uma conta? <a href="/login-empresa">Fazer login como empresa</a></p>
        <p>É um usuário individual? <a href="/cadastro">Cadastrar como usuário</a></p>
      </div>
    </main>

    <footer></footer>

    <script src="/js/validation.js"></script>
    <script src="/js/input-masks.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const empresaValidator1 = initFormValidation('empresaForm1');
        
        // Botão próximo com validação
        document.getElementById('btnProximo').addEventListener('click', function(e) {
          e.preventDefault();
          if (empresaValidator1.validateForm()) {
            // Se validação passou, submeter o formulário
            document.getElementById('empresaForm1').submit();
          }
        });
      });
    </script>
  </body>
</html>